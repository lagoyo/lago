<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>schema-org-adapter test</title>
    <style type="text/css">
        html.busy, html.busy * {
            cursor: wait !important;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/semantifyit/schema-org-adapter/dist/schema-org-adapter.min.js"></script>
    <script>
        const mySDOAdapter = new SDOAdapter()


        function getCategories() {
            return mySDOAdapter.getListOfClasses().sort();
        }

        function setBusy(isBusy) {
            if( isBusy ) {
                $('body').addClass('busy');
            }
            else {
                $('body').removeClass('busy');
            }
        }

        function onCategory(category) {

            if( category.indexOf("schema:") < 0 ) return ;
            let obj = mySDOAdapter.getClass(category);
            if( obj == null ) return ;

            let properties = obj.getProperties(false);
            console.log("properties : ");
            console.log(properties);
            $('#div_properties').empty();
            let properties_html = $('#template_properties').html();
            $('#div_properties').append($(properties_html));
            let $properties = $('#div_properties').find('tbody');
            for( let i=0; i<properties.length; i++) {
                let name=properties[i].split(':')[1];
                let property = mySDOAdapter.getProperty(properties[i]);
                let dataTypes = property.getRanges(false);
                let strTypes = "";
                for( let j=0; j<dataTypes.length; j++) {
                    let isClass = false;
                    if( j!=0 ) strTypes += "<br>";
                    strTypes += dataTypes[j].split(':')[1];


                }
                let option=$("<tr><td>"+property.getName()+"</td><td>"+strTypes
                    +"</td><td>"+ property.getDescription() +"</td></tr>");

                $properties.append(option);

                console.log(property.getName());
                console.log(property.toJSON());
            }
        }

        function initCategories() {
            $('#category').empty();

            let categories = getCategories();
            console.log("categories are");
            console.log(categories);


            for( let i=0; i<categories.length; i++) {
                let name=categories[i].split(':')[1];
                let option=$("<option>"+name+"</option>").prop("value", categories[i]);
                if( name == "Dataset" ) {
                    option.prop("selected", "selected");
                }
                $('#category').append(option);
            }

            $('#category').on('change', function () {
                onCategory(this.value);
            });
            onCategory( $('#category option:selected').val() );
        }
        async function main() {
            setBusy(true);
            const urlLatestSDO = await mySDOAdapter.constructSDOVocabularyURL('latest', 'all-layers');
            // resolves to "https://raw.githubusercontent.com/schemaorg/schemaorg/master/data/releases/6.0/all-layers.jsonld" if 6.0 is the latest version
            await mySDOAdapter.addVocabularies([urlLatestSDO])
            setBusy(false);

            /*let Hotel = mySDOAdapter.getClass('schema:Dataset')
            let measurementTechnique = mySDOAdapter.getProperty("schema:abstract");
            console.log("measurementTechnique is");
            console.log(measurementTechnique);
            let _Proper = Hotel.getProperties() // 117 -> ["schema:audience", "schema:checkinTime", "schema:availableLanguage", ...]
            Hotel.getSuperClasses(false) //only direct superclasses: 1 -> ["schema:LodgingBusiness"]
            Hotel.getSuperClasses() //5 -> ["schema:LodgingBusiness", "schema:LocalBusiness", "schema:Place", "schema:Organization", "schema:Thing"]

            console.log("Dataset is");
            console.log(_Proper);
            */
            /*
            let address = mySDOAdapter.getProperty("schema:DataCatalog")
            address.getRanges() // 2 -> ["schema:PostalAddress", "schema:Text"]
            address.getDomains(false) // only direct domains: 5 -> ["schema:Place", "schema:GeoCoordinates", "schema:GeoShape", "schema:Person", "schema:Organization"]
            address.getDomains() // 229 -> ["schema:Place", "schema:Accommodation", "schema:TouristAttraction", ...]

             */
            initCategories();
        }


        $(function(){
            main();
        });
    </script>
</head>
<body>
<H1><a  href="https://www.npmjs.com/package/schema-org-adapter"> schema-org-adapter </a> test</H1>

category : <select name="category" id="category"></select><br>
properties :

<div id="div_properties">

</div>

<div id="template_properties" style="display: none">
    <table>
        <thead>
        <tr><td>name</td><td>type</td><td>description</td></tr>
        </thead>
        <tbody >

        </tbody>
    </table>
</div>
</body>
</html>
